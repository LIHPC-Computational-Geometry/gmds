
name: continuous-windows

on:
  push:
    branches: [ cmake-portage-windows ]
  pull_request:
    branches: [ cmake-portage-windows ]
    
jobs:
  Continuous:
    runs-on: windows-latest
    steps:
  
    - name: Check out repository code
      uses: actions/checkout@v2
        
    - name: Setup cmake
      uses: jwlawson/actions-setup-cmake@v1.9
      with:
        cmake-version: '3.16.x'
    
    - name: replace vcvarsall (https://github.com/marketplace/actions/visual-studio-shell)
      uses: egor-tensin/vs-shell@v2
      with:
        arch: x64          

    - name: place nmake into PATH (https://github.com/ilammy/msvc-dev-cmd)
      uses: ilammy/msvc-dev-cmd@v1
    
    - name: glpk config
      run: cd ${{github.workspace}}\external\glpk\src\glpk\w64 && copy config_VC config.h
      
    - name: Compile glpk    
      run: nmake /f ${{github.workspace}}\external\glpk\src\glpk\w64\Makefile_VC_DLL
      
    - name: Create Build Environment    
      run: cmake -S ${{github.workspace}} -B ${{github.workspace}}/build -Ax64
